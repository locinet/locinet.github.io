---
pagination:
  data: site.authorPages
  size: 1
  alias: authorPage
permalink: "/authors/{{ authorPage.slug }}/"
layout: layout.njk
eleventyComputed:
  pageTitle: "{{ authorPage.name }} — Locinet"
  navExtra: '{% if not authorPage.isCorporate %}<div class="add-work-container"><a href="#" class="contribute-link" id="contribute-btn" data-author-name="{{ authorPage.name }}" data-author-qid="{{ authorPage.qid }}">Add a work</a><div class="add-work-panel" id="add-work-panel" style="display:none;"></div></div>{% endif %}'
---

{% if authorPage.imageUrl %}
  <a href="{{ authorPage.commonsUrl }}" class="author-image-link">
    <img class="author-image" src="{{ authorPage.imageUrl }}?width=300" alt="{{ authorPage.name }}">
  </a>
{% endif %}

<div class="author-header">
  <h1>{{ authorPage.name }}</h1>
  {% for al in authorPage.authorLabels %}
    <p class="author-label">{{ al.label }}</p>
  {% endfor %}
  <p class="author-dates">
    {% if authorPage.birthYear %}{{ authorPage.birthYear }}{% endif %}{% if authorPage.deathYear %}–{{ authorPage.deathYear }}{% endif %}
  </p>
  {% if authorPage.isCorporate and authorPage.members.length > 0 %}
    <p class="corporate-members">Members:
      {%- for member in authorPage.members %}
        <a href="/authors/{{ member.slug }}/">{{ member.name }}</a>
        {%- if not loop.last %}, {% endif -%}
      {%- endfor %}
    </p>
  {% endif %}
  <p class="author-ext-links">
    {% if authorPage.wikipediaUrl %}
      <a href="{{ authorPage.wikipediaUrl }}">Wikipedia</a> ·
    {% endif %}
    {% if authorPage.prdlId %}
      <a href="https://www.prdl.org/author_view.php?a_id={{ authorPage.prdlId }}">PRDL</a> ·
    {% endif %}
    {% if authorPage.qid and authorPage.qid.startsWith("Q") %}
      <a href="https://www.wikidata.org/wiki/{{ authorPage.qid }}">Wikidata</a>
    {% endif %}
  </p>
</div>

<div class="filter-box">
  <label for="loci-filter">Filter by locus:</label>
  <input type="text" id="loci-filter" placeholder="Type to filter..." autocomplete="off">
  <button type="button" id="clear-filter" class="clear-btn">Clear</button>
</div>

<div id="works-list">
{% for work in authorPage.works %}
  {% set allLociJson %}{{ work.allLoci | dump | safe }}{% endset %}
  <div class="work" id="{{ work.id }}" data-loci="{{ allLociJson }}">
    <div class="work-header">
      <h2 class="work-title">{{ work.title }}
        <a href="#" class="edit-link" data-work-id="{{ work.id }}" data-yaml-filename="{{ work.yamlFilename }}">[Edit]</a>
      </h2>
      {% if work.origTitle and work.origTitle != work.title %}
        <p class="work-title-orig"><em>{% if work.origUrl %}<a href="{{ work.origUrl }}">{{ work.origTitle }}</a>{% else %}{{ work.origTitle }}{% endif %}</em></p>
      {% endif %}

      {# Corporate authorship attribution on individual author pages #}
      {% if not authorPage.isCorporate and work.corporateAuthor %}
        <p class="corporate-attribution">(
          {%- if work.coMembers.length > 0 -%}
            with
            {%- for m in work.coMembers %}
              <a href="/authors/{{ m.slug }}/">{{ m.name }}</a>
              {%- if not loop.last %}, {% endif -%}
            {%- endfor %}
            as members of
          {%- else -%}
            as member of
          {%- endif %}
          <a href="/authors/{{ work.corporateAuthor.slug }}/">{{ work.corporateAuthor.label }}</a>)</p>
      {% endif %}

      {# Edition info #}
      {% for ed in work.origEditions %}
        <p class="edition-info">
          {% if ed.place %}{{ ed.place }}, {% endif %}{% if ed.year %}{{ ed.year }}.{% endif %}
          {% for s in ed.sites %}
            Original: <a href="{{ s.url }}">{{ s.siteName }}</a>
          {% endfor %}
        </p>
      {% endfor %}

      {# Full text line #}
      {% if work.translations.length > 0 %}
        <p class="translations-summary">
          {%- for t in work.translations %}
            Full text in English translated by {% if t.translatorInfo and t.translatorInfo.website %}<a href="{{ t.translatorInfo.website }}">{{ t.translator }}</a>{% else %}{{ t.translator }}{% endif %}
            {%- if t.translatorInfo and t.translatorInfo.support %} (<a href="{{ t.translatorInfo.support }}">support</a>){% endif %}
            {%- if t.translatorInfo and t.translatorInfo.paypal %} (<a href="https://www.paypal.com/us/home">PayPal</a> {{ t.translatorInfo.paypal }}){% endif %}
            {%- if t.year %} ({{ t.year }}){% endif -%}
            :
            {%- for s in t.sites %}
              {%- if s.url %}
                <a href="{{ s.url }}">{{ s.siteName }}</a>
              {%- elif s.volumes %}
                {{ s.siteName }}
                {%- for volNum, volUrl in s.volumes %}
                  <a href="{{ volUrl }}">Vol. {{ volNum }}</a>
                  {%- if not loop.last %}, {% endif -%}
                {%- endfor %}
              {%- else %}
                {{ s.siteName }}
              {%- endif -%}
              {%- if not loop.last %}, {% endif -%}
            {%- endfor -%}
            {%- if not loop.last -%}. {% endif -%}
          {%- endfor %}
        </p>
      {% endif %}

      {# Work-level loci #}
      {% if work.workLoci.length > 0 %}
        <span class="loci-tags">
          {% for tag in work.workLoci %}
            <a class="loci-tag" href="/?locus={{ tag }}" data-slug="{{ tag }}">{{ site.lociFlat[tag].name if site.lociFlat[tag] else tag }}</a>
          {% endfor %}
        </span>
      {% endif %}
    </div>

    {# Sections #}
    {% if work.flatSections.length > 0 %}
      <ul class="sections-list">
        {% for section in work.flatSections %}
          {% set sectionLociJson %}{{ section.loci | dump | safe }}{% endset %}
          <li class="section-item depth-{{ section.depth }}" data-loci="{{ sectionLociJson }}"
              style="margin-left: {{ section.depth * 1.5 }}em;">
            {# Collect all section URLs for this section #}
            {% set sectionLinks = [] %}
            {% for t in work.translations %}
              {% for s in t.sites %}
                {% set sUrl = s.sectionUrls[section.id] %}
                {% if sUrl %}
                  {% set sectionLinks = (sectionLinks.push({url: sUrl, siteName: s.siteName}), sectionLinks) %}
                {% endif %}
              {% endfor %}
            {% endfor %}
            {% if sectionLinks.length == 1 %}
              <a href="{{ sectionLinks[0].url }}" class="section-title">{{ section.title }}</a>
            {% else %}
              <span class="section-title">{{ section.title }}</span>
              {% for link in sectionLinks %}
                <a href="{{ link.url }}" class="section-link">[{{ link.siteName }}]</a>
              {% endfor %}
            {% endif %}
            {# Loci tags #}
            {% if section.loci.length > 0 %}
              <span class="loci-tags">
                {% for tag in section.loci %}
                  <a class="loci-tag" href="/?locus={{ tag }}" data-slug="{{ tag }}">{{ site.lociFlat[tag].name if site.lociFlat[tag] else tag }}</a>
                {% endfor %}
              </span>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    {% endif %}
  </div>
{% endfor %}
</div>

<script>
  const lociFlat = {{ site.lociFlat | dump | safe }};
  const authorName = {{ authorPage.name | dump | safe }};
  const authorQid = {{ authorPage.qid | dump | safe }};
  const authorOlId = {{ authorPage.openLibraryId | dump | safe }};
  const authorOrigName = {{ authorPage.origLangName | dump | safe }};
</script>

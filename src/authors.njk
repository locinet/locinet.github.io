---
pagination:
  data: site.authorPages
  size: 1
  alias: authorPage
permalink: "/authors/{{ authorPage.slug }}/"
layout: layout.njk
eleventyComputed:
  pageTitle: "{{ authorPage.name }} — Locinet"
  navExtra: '{% if not authorPage.isCorporate %}<div class="add-work-container"><a href="#" class="contribute-link" id="contribute-btn" data-author-name="{{ authorPage.name }}" data-author-qid="{{ authorPage.qid }}">Add a work</a><div class="add-work-panel" id="add-work-panel" style="display:none;"></div></div>{% endif %}'
---

{% if authorPage.imageUrl %}
  <a href="{{ authorPage.commonsUrl }}" class="author-image-link">
    <img class="author-image" src="{{ authorPage.imageUrl }}?width=300" alt="{{ authorPage.name }}">
  </a>
{% endif %}

<div class="author-header">
  <h1>{{ authorPage.name }}</h1>
  {% for al in authorPage.authorLabels %}
    <p class="author-label">{{ al.label }}</p>
  {% endfor %}
  <p class="author-dates">
    {% if authorPage.birthYear %}{{ authorPage.birthYear }}{% endif %}{% if authorPage.deathYear %}–{{ authorPage.deathYear }}{% endif %}
  </p>
  {% if authorPage.isCorporate and authorPage.members.length > 0 %}
    <p class="corporate-members">Members:
      {%- for member in authorPage.members %}
        <a href="/authors/{{ member.slug }}/">{{ member.name }}</a>
        {%- if not loop.last %}, {% endif -%}
      {%- endfor %}
    </p>
  {% endif %}
  <p class="author-ext-links">
    {% set hasLink = false %}
    {% if authorPage.wikipediaUrl %}
      <a href="{{ authorPage.wikipediaUrl }}">Wikipedia</a>
      {% set hasLink = true %}
    {% endif %}
    {% if authorPage.prdlId %}
      {% if hasLink %} · {% endif %}<a href="https://www.prdl.org/author_view.php?a_id={{ authorPage.prdlId }}">PRDL</a>
      {% set hasLink = true %}
    {% endif %}
    {% if authorPage.qid and authorPage.qid.startsWith("Q") %}
      {% if hasLink %} · {% endif %}<a href="https://www.wikidata.org/wiki/{{ authorPage.qid }}">Wikidata</a>
    {% endif %}
  </p>
</div>

<div class="filter-box">
  <label for="loci-filter">Filter by locus:</label>
  <input type="text" id="loci-filter" placeholder="Type to filter..." autocomplete="off">
  <button type="button" id="clear-filter" class="clear-btn">Clear</button>
</div>

<div id="works-list">
{% for work in authorPage.works %}
  {% set allLociJson %}{{ work.allLoci | dump | safe }}{% endset %}
  {% set hasText = work.sectionTexts and (work.sectionTexts | length > 0) %}
  {% set editionInfo %}{% for ed in work.origEditions %}{% if ed.place %}{{ ed.place }}, {% endif %}{% if ed.year %}{{ ed.year }}{% endif %}{% if not loop.last %}; {% endif %}{% endfor %}{% endset %}
  {% set translationInfo %}{% for t in work.translations %}Translated by {{ t.translator }}{% if t.year %} ({{ t.year }}){% endif %}{% if t.AI %} [AI]{% endif %}{% if not loop.last %}. {% endif %}{% endfor %}{% endset %}
  {% set authorDates %}{% if authorPage.birthYear %}{{ authorPage.birthYear }}{% endif %}{% if authorPage.deathYear %}–{{ authorPage.deathYear }}{% endif %}{% endset %}
  <div class="work" id="{{ work.id }}" data-loci="{{ allLociJson }}"
       {% if hasText %}data-has-text="1" data-work-title="{{ work.title }}" data-work-orig-title="{{ work.origTitle }}" data-work-author="{{ authorPage.name }}" data-author-orig-name="{{ authorPage.origLangName }}" data-author-dates="{{ authorDates | trim }}" data-author-image="{{ authorPage.imageUrl }}" data-edition-info="{{ editionInfo | trim }}" data-translation-info="{{ translationInfo | trim }}"{% endif %}>
    <div class="work-header">
      <h2 class="work-title">{{ work.title }}
        <a href="#" class="edit-link" data-work-id="{{ work.id }}" data-yaml-filename="{{ work.yamlFilename }}">[Edit]</a>
      </h2>
      {% if work.origTitle and work.origTitle != work.title %}
        {% set hasCollectionEdition = false %}
        {% for ed in work.origEditions %}
          {% if ed.collection %}{% set hasCollectionEdition = true %}{% endif %}
        {% endfor %}
        <p class="work-title-orig"><em>{% if work.origUrl and not hasCollectionEdition %}<a href="{{ work.origUrl }}">{{ work.origTitle }}</a>{% else %}{{ work.origTitle }}{% endif %}</em>{% if work.origYear %} ({{ work.origYear }}){% endif %}</p>
      {% endif %}

      {# Collection edition info #}
      {% for ed in work.origEditions %}
        {% if ed.collection and ed.title %}
          <p class="work-title-orig collection-info">from <em>{% if ed.sites.length > 0 and ed.sites[0].url %}<a href="{{ ed.sites[0].url }}">{{ ed.title }}</a>{% else %}{{ ed.title }}{% endif %}</em>{% if ed.place or ed.year %} ({% if ed.place %}{{ ed.place }}{% endif %}{% if ed.place and ed.year %}, {% endif %}{% if ed.year %}{{ ed.year }}{% endif %}){% endif %}</p>
        {% endif %}
      {% endfor %}

      {# Corporate authorship attribution on individual author pages #}
      {% if not authorPage.isCorporate and work.corporateAuthor %}
        <p class="corporate-attribution">(
          {%- if work.coMembers.length > 0 -%}
            with
            {%- for m in work.coMembers %}
              <a href="/authors/{{ m.slug }}/">{{ m.name }}</a>
              {%- if not loop.last %}, {% endif -%}
            {%- endfor %}
            as members of
          {%- else -%}
            as member of
          {%- endif %}
          <a href="/authors/{{ work.corporateAuthor.slug }}/">{{ work.corporateAuthor.label }}</a>)</p>
      {% endif %}

      {# Edition info (non-collection only) #}
      {% for ed in work.origEditions %}
        {% if not ed.collection %}
        <p class="edition-info">
          {% if ed.place %}{{ ed.place }}, {% endif %}{% if ed.year %}{{ ed.year }}.{% endif %}
          {% for s in ed.sites %}
            Original: <a href="{{ s.url }}">{{ s.siteName }}</a>
          {% endfor %}
        </p>
        {% endif %}
      {% endfor %}

      {# Full text line #}
      {% if work.translations.length > 0 %}
        <p class="translations-summary{% if work.flatSections.length > 0 %} sections-toggle{% endif %}">
          {%- for t in work.translations %}
            Full text in English translated by {% if t.AI %}AI with thanks to {% endif %}{% if t.translatorInfo and t.translatorInfo.website %}<a href="{{ t.translatorInfo.website }}">{{ t.translator }}</a>{% else %}{{ t.translator }}{% endif %}
            {%- if t.translatorInfo and t.translatorInfo.support %} (<a href="{{ t.translatorInfo.support }}">support</a>){% endif %}
            {%- if t.translatorInfo and t.translatorInfo.paypal %} (<a href="https://www.paypal.com/us/home">PayPal</a> {{ t.translatorInfo.paypal }}){% endif %}
            {%- if t.year %} ({{ t.year }}){% endif -%}
            :
            {%- set hasSiteLink = false -%}
            {%- for s in t.sites %}
              {%- if s.sectionTexts | length > 0 %}
                {# Local/text site — skip site name, show download links below #}
              {%- elif s.url %}
                {%- if hasSiteLink %}, {% endif -%}
                <a href="{{ s.url }}">{{ s.siteName }}</a>
                {%- set hasSiteLink = true -%}
              {%- elif s.volumes %}
                {%- if hasSiteLink %}, {% endif -%}
                {{ s.siteName }}
                {%- for volNum, volUrl in s.volumes %}
                  <a href="{{ volUrl }}">Vol. {{ volNum }}</a>
                  {%- if not loop.last %}, {% endif -%}
                {%- endfor %}
                {%- set hasSiteLink = true -%}
              {%- else %}
                {%- if hasSiteLink %}, {% endif -%}
                {{ s.siteName }}
                {%- set hasSiteLink = true -%}
              {%- endif -%}
            {%- endfor -%}
            {%- if hasText -%}
              {%- if hasSiteLink %}, {% endif -%}
              {% if work.pdfUrl -%}
                <a href="{{ work.pdfUrl }}">PDF</a>
              {%- else -%}
                <a href="#" class="download-link" data-format="pdf">PDF</a>
              {%- endif %} · <a href="#" class="download-link" data-format="epub">EPUB</a>
            {%- endif -%}
            {%- if not loop.last -%}. {% endif -%}
          {%- endfor %}
        </p>
      {% endif %}

      {# Work-level loci #}
      {% if work.workLoci.length > 0 %}
        <span class="loci-tags">
          {% for tag in work.workLoci %}
            <a class="loci-tag" href="/?locus={{ tag }}" data-slug="{{ tag }}">{{ site.lociFlat[tag].name if site.lociFlat[tag] else tag }}</a>
          {% endfor %}
        </span>
      {% endif %}

    </div>

    {# Sections #}
    {% if work.flatSections.length > 0 %}
      {% if hasText %}
        <p class="expand-all-toggle" style="display:none"><a href="#" class="expand-all-link">Expand all</a></p>
      {% endif %}
      <ul class="sections-list sections-collapsed">
        {% for section in work.flatSections %}
          {% set sectionLociJson %}{{ section.loci | dump | safe }}{% endset %}
          {% set sText = work.sectionTexts[section.id] if work.sectionTexts else null %}
          <li class="section-item depth-{{ section.depth }}{% if sText %} has-text{% endif %}" data-loci="{{ sectionLociJson }}"
              style="margin-left: {{ section.depth * 1.5 }}em;">
            {# Collect all section URLs for this section #}
            {% set sectionLinks = [] %}
            {% for t in work.translations %}
              {% for s in t.sites %}
                {% set sUrl = s.sectionUrls[section.id] %}
                {% if sUrl %}
                  {% set sectionLinks = (sectionLinks.push({url: sUrl, siteName: s.siteName}), sectionLinks) %}
                {% endif %}
              {% endfor %}
            {% endfor %}
            {% for ed in work.origEditions %}
              {% for s in ed.sites %}
                {% if s.sectionUrls %}
                  {% set sUrl = s.sectionUrls[section.id] %}
                  {% if sUrl %}
                    {% set sectionLinks = (sectionLinks.push({url: sUrl, siteName: s.siteName}), sectionLinks) %}
                  {% endif %}
                {% endif %}
              {% endfor %}
            {% endfor %}
            {% if sectionLinks.length == 1 %}
              <a href="{{ sectionLinks[0].url }}" class="section-title">{{ section.title }}</a>
            {% elif sText %}
              <span class="section-title" role="button" tabindex="0">{{ section.title }}</span>
            {% else %}
              <span class="section-title">{{ section.title }}</span>
              {% for link in sectionLinks %}
                <a href="{{ link.url }}" class="section-link">[{{ link.siteName }}]</a>
              {% endfor %}
            {% endif %}
            {# Loci tags #}
            {% if section.loci.length > 0 %}
              <span class="loci-tags">
                {% for tag in section.loci %}
                  <a class="loci-tag" href="/?locus={{ tag }}" data-slug="{{ tag }}">{{ site.lociFlat[tag].name if site.lociFlat[tag] else tag }}</a>
                {% endfor %}
              </span>
            {% endif %}
            {# Expandable text #}
            {% if sText %}
              <div class="section-text">{{ sText }}</div>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    {% endif %}
  </div>
{% endfor %}
</div>

<script>
  const lociFlat = {{ site.lociFlat | dump | safe }};
  const authorName = {{ authorPage.name | dump | safe }};
  const authorQid = {{ authorPage.qid | dump | safe }};
  const authorOlId = {{ authorPage.openLibraryId | dump | safe }};
  const authorOrigName = {{ authorPage.origLangName | dump | safe }};
</script>




<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{{ page.title }} - {{ site.title }}</title>
  <style>
    body { max-width: 800px; margin: 2rem auto; line-height: 1.6; }
    a { color: blue; text-decoration: none; }
    h1,h2,h3 { margin-top: 1.5em; }
    ul { list-style-type: none; padding-left: 0; }
    li { margin-bottom: 0.5em; }
  </style>
</head>
<body>
  <header>
    <h1><a href="{{ '/' | relative_url }}">{{ site.title }}</a></h1>
  </header>
  <main>
{% assign work = nil %}
{% for pair in site.data %}
  {% if pair[1].works %}
    {% for w in pair[1].works %}
      {% if w.id == page.work_id %}
        {% assign work = w %}
      {% endif %}
    {% endfor %}
  {% endif %}
{% endfor %}

{% if work == nil %}
  <p>Work not found.</p>
{% else %}
<h1><em>{{ work.title }}</em></h1>
<p>
  <strong>{{ work.author }}</strong>
  {% if work.year %} ({{ work.year }}){% endif %}
</p>

{% for item in work.structure %}
  <h2>{{ item.type | capitalize }} {{ item.number }}: {{ item.title.en }}</h2>
  {% if item.children %}
    <ul>
      {% for child in item.children %}
  <li>
    {{ child.type | capitalize }} {{ child.number }} —
    {{ child.title.en }}

    {% if child.links %}
      {% for link in child.links %}
         — <a href="{{ link.url }}" target="_blank">{{ link.site }}</a>
      {% endfor %}
    {% endif %}
    
    {% comment %}Find topics for this section{% endcomment %}
    {% assign section_row = site.data.topics | where: "work_id", page.work_id | where: "section_id", child.id | first %}
    
    {% if section_row %}
      {% assign topic_ids = section_row.topic_ids | split: "," %}
      <br>
      <small>Topics: 
        {% for topic_id in topic_ids %}
          {% assign topic_def = site.data.topics_definitions | where: "topic_id", topic_id | first %}
          {% if topic_def %}
            <a href="{{ '/topics.html#' | append: topic_id | relative_url }}">
              {{ topic_def.topic_name }}
            </a>
          {% endif %}
        {% endfor %}
      </small>
    {% endif %}

  </li>
{% endfor %}
    </ul>
  {% endif %}
{% endfor %}
{% endif %}
  </main>
</body>
</html>



---
layout: default
title: Topics Index
---
<h2>Topics</h2>

{% for topic in site.data.topics_definitions.topics %}
  <h3 id="{{ topic.id }}">{{ topic.name }}</h3>
  <p style="margin-top:0;">{{ topic.description }}</p>

  {% assign printed_work_ids = "" | split: "" %}

  {% for data in site.data %}
    {% if data[1].assignments and data[1].work_id %}
      {% assign topic_file = data[1] %}
      {% assign work = nil %}

      {% for w in site.data.institutes.works %}
        {% if w.id == topic_file.work_id %}
          {% assign work = w %}
        {% endif %}
      {% endfor %}

      {% if work %}
        {% assign matching_sections = "" | split: "" %}

        {% for assignment in topic_file.assignments %}
          {% comment %}
            IMPORTANT:
            Match if ANY assigned topic is:
            - the top-level topic
            - OR a descendant of the top-level topic
          {% endcomment %}

          {% for assigned_topic in assignment.topics %}
            {% assign assigned_def = topic_lookup | where: "id", assigned_topic | first %}

            {% if assigned_def %}
              {% if assigned_def.id == topic.id or assigned_def.parent == topic.id %}
                {% for item in work.structure %}
                  {% if item.children %}
                    {% for child in item.children %}
                      {% if child.id == assignment.section_id %}
                        {% assign matching_sections = matching_sections | push: child %}
                      {% endif %}
                    {% endfor %}
                  {% endif %}
                {% endfor %}
              {% endif %}
            {% endif %}
          {% endfor %}
        {% endfor %}

        {% if matching_sections.size > 0 %}
          {% unless printed_work_ids contains work.id %}
            <p style="margin-bottom:0.2em;">
              <strong>
                <a href="{{ '/works/' | append: work.id | relative_url }}">
                  {{ work.title }}
                </a>
              </strong>
            </p>
            {% assign printed_work_ids = printed_work_ids | push: work.id %}
          {% endunless %}

          <ul>
            {% for section in matching_sections %}
              <li>
                {% if section.links %}
                  {% assign primary_link = section.links | first %}
                  <a href="{{ primary_link.url }}" target="_blank">
                    {{ section.type | capitalize }} {{ section.number }} —
                    {{ section.title.en }}
                  </a>
                {% else %}
                  {{ section.type | capitalize }} {{ section.number }} —
                  {{ section.title.en }}
                {% endif %}
              </li>
            {% endfor %}
          </ul>
        {% endif %}
      {% endif %}
    {% endif %}
  {% endfor %}
{% endfor %}
